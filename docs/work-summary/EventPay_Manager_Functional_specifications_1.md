# EventPay Manager 機能仕様書

## 📋 プロジェクト概要

### 🎯 コンセプト
飲み会の幹事負担を軽減する、ユーザー登録不要の出欠・精算管理アプリ

### 解決する課題
- 1次会→2次会→3次会と続く飲み会で、各回の参加者管理が煩雑
- 誰が参加費を払ったか/払ってないかの把握が大変
- 特に2次会以降は突発的に決まるため、その場での管理が困難

## 👥 ステークホルダーと役割

### 幹事（主催者）
- イベント（飲み会）を作成・管理
- n次会まで柔軟に追加可能
- 参加者の支払い状況を管理
- 未払い者へのリマインダー一括送信

### 参加者
- 共有URLから自己登録（名前・メールアドレスのみ）
- 各回への参加を選択（1次会スキップ等も可能）
- 自分の支払い状況を確認
- 参加者リストを閲覧

## 🔐 アクセス管理（ハイブリッド方式）

### 調整さん型のユーザー登録不要システム

```
初回登録
    ↓
┌─────────────┬─────────────┐
│  メール送信  │ ローカル保存 │
│  編集用URL  │   トークン   │
└─────────────┴─────────────┘
    ↓            ↓
 別デバイス    同一デバイス
 でも編集可    なら自動表示
```

**メリット：**
- パスワード管理不要
- 参加のハードルが低い
- デバイスを変えてもアクセス可能（メールURL）
- 同一デバイスなら自動的に情報表示

## 📱 主要機能詳細

### 1. イベント管理機能

#### イベント作成
- **基本情報**
  - イベント名（例：営業部歓送迎会）
  - 開催日
  - 備考・説明

#### 各回（n次会）管理
- **設定項目**
  - 会場名
  - 開始時間
  - 参加費（全員統一）
- **柔軟な追加**
  - 当日でもスマホから2次会、3次会を追加可能

### 2. 参加者登録機能

#### 初回登録フロー
1. 共有URLにアクセス
2. 基本情報入力
   - 名前（必須）
   - メールアドレス（必須）
3. 参加回選択
   ```
   □ 1次会（19:00〜 ¥3,000）
   □ 2次会（21:00〜 ¥2,000）
   □ 3次会（23:00〜 ¥1,500）
   ```
4. 登録完了
   - 編集用URLをメール送信
   - ローカルストレージにトークン保存

#### 参加パターンの柔軟性
- 1次会のみ参加
- 2次会から参加（1次会スキップ）
- 2次会のみ参加
- 全て参加
- その他あらゆるパターンに対応

### 3. 支払い管理機能

#### 幹事専用機能
- 参加者一覧で支払い状況を確認
- チェックボックスで支払い済みを更新
- 各回ごとの支払い状況を独立管理

#### 表示例
```
参加者一覧：
田中さん：1次会[参加-済] 2次会[参加-未] 3次会[不参加]
鈴木さん：1次会[不参加] 2次会[参加-済] 3次会[参加-済]
佐藤さん：1次会[参加-未] 2次会[不参加] 3次会[不参加]
```

### 4. リマインダー機能

#### 送信フロー
1. 幹事が送信対象の回を選択
2. その回の未払い参加者を自動抽出
3. 一括でリマインダーメール送信
4. 送信タイミングは幹事が任意決定

#### メール内容
- 件名：[イベント名] 参加費のお支払いについて
- 本文：
  - 支払い確認のお願い
  - 金額と支払い先情報
  - 編集用URL（状況確認用）

### 5. 参加者閲覧機能

#### マイページで確認可能な情報
- 自分の各回の参加・支払い状況
- イベント詳細（日時、会場等）
- 参加者リスト（名前のみ）

## 💾 データ構造

### イベント（events）
```ruby
- id: integer
- name: string          # イベント名
- date: date           # 開催日
- description: text    # 備考
- share_token: string  # 共有URL用トークン
- created_at: datetime
- updated_at: datetime
```

### 各回（rounds）
```ruby
- id: integer
- event_id: integer    # 所属イベント
- order: integer       # 順番（1次会=1, 2次会=2...）
- venue: string        # 会場名
- start_time: time     # 開始時間
- fee: integer         # 参加費
- created_at: datetime
- updated_at: datetime
```

### 参加者（participants）
```ruby
- id: integer
- event_id: integer    # 所属イベント
- name: string         # 名前
- email: string        # メールアドレス
- edit_token: string   # 編集URL用トークン
- created_at: datetime
- updated_at: datetime
```

### 参加状況（participations）
```ruby
- id: integer
- participant_id: integer  # 参加者
- round_id: integer       # 各回
- is_joining: boolean     # 参加/不参加
- is_paid: boolean        # 支払い済/未払い
- created_at: datetime
- updated_at: datetime
```

## 🚀 実装優先順位

### Phase 1：MVP（最小限の製品）
1. イベント作成・編集機能
2. 共有URL生成
3. 参加者自己登録
4. 支払い状況管理（幹事のみ）
5. 基本的な閲覧画面

### Phase 2：利便性向上
1. ハイブリッドアクセス管理実装
2. リマインダー機能
3. スマホ最適化（特に幹事の2次会追加）
4. 参加状況の後からの変更

### Phase 3：拡張機能
1. 参加者別料金設定
2. 支払い方法の記録（現金/PayPay等）
3. 過去イベントのアーカイブ・検索
4. 統計情報（支払い率等）

## ✅ 成功指標

### 定量的指標
- 幹事の管理時間を50%削減
- 参加者の登録完了率90%以上
- 支払い忘れを80%削減
- ユーザー登録なしでの利用率100%

### 定性的指標
- 「調整さんのように簡単」という評価
- 2次会の急な追加でもスムーズに管理
- 参加者からの問い合わせ減少

## 🔮 将来の拡張構想

### 他アプリとの連携
- **EventTodo Manager**：幹事のTODO管理
- **EventChat**：当日のリアルタイムチャット
- **EventInfo Hub**：会場情報・地図表示

### 技術的準備
- RESTful API設計
- 共通認証基盤の検討
- マイクロサービス化を視野に入れた設計

---

*この仕様書は開発の進行に応じて更新されます。*
*作成日：2025年1月7日*